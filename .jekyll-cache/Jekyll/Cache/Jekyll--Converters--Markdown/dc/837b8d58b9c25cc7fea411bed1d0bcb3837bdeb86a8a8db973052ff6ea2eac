I"„#<p>Although Generative Adversarial Networks (GANs) are breaking the ground in daily
basis, there is no gold-standard metric to measure how well the genertor works.
We all know that several ML tasks‚Äô standard metrics - such as mean square error (MSE)
for linear regression and cross entropy for classification - but what about for
GANs? How do we choose the <em>best</em> model upon our model selection?</p>

<h2 id="why-is-evaluating-gans-hard">Why is evaluating GANs hard?</h2>

<p>Let‚Äôs break down the necessities first. We need to take care of two main 
characterstics for the generated images: <strong>fidelity</strong> and <strong>diversity</strong>.</p>

<dl>
  <dt>Fidelity</dt>
  <dd>Quality of images - how realistic are the generated images; discriminability.</dd>
  <dt>Diversity</dt>
  <dd>Variaty of images. GANs should not generate single image any time.</dd>
</dl>

<p>Not only for those two, it has been suggested to measure disentanglement of the 
latent space, boundness, agreement with human perceptual judgements, etc.<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>
After all those traits to fulfill, there has yet to appear a concurred metric
for evaluating GANs.</p>

<h2 id="qualitative-measurements">Qualitative Measurements</h2>

<p><img src="/assets/images/2021-01-16-qualitative.png" alt="Qualitative measures" /></p>
<blockquote>
  <p>Qualitative measures, from Ali(2019).<sup id="fnref:1:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></p>
</blockquote>

<p>It is definitely possible to hire persons to manually evaluate each model, but 
is not a valid option in ordinary cases due to the cost and consistency issues.</p>

<p>According to the survey paper, there are some of qualitative approaches to measure
performance of GANs:</p>

<ol>
  <li>Nearest Neighbors</li>
  <li>Rapid Scene Categorization</li>
  <li>Rating and Preference Judgment</li>
  <li>Evaluating Mode Drop and Mode Collapse</li>
  <li>Investigating and Visualizing the Internals of Networks.</li>
</ol>

<p>All above requires human participants, but if those are done by M-Turk or equivalent
cost-efficient services, they can be some promising measures to detect apparent
features. 
We‚Äôll skip the thorough examination of each metric in this post. Instead, let‚Äôs
focus on some quantitative metrics which are widely used.</p>

<h2 id="quantitative-measurements">Quantitative Measurements</h2>

<p><img src="/assets/images/2021-01-16-quantitative.png" alt="Quantitative measures" /></p>
<blockquote>
  <p>Quantitative measures, from Ali(2019).<sup id="fnref:1:2" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></p>
</blockquote>

<p>There are tons of metrics suggested above, but we‚Äôll focus on Inception Score (IS), 
Fr√©chet Incption Distance (FID) and Maximum Mean Discrepancy (MMD) from the table.</p>

<h3 id="inception-score-is">Inception Score (IS)</h3>

<p>IS is based on the pre-trained ImageNet model, <em>Inception-v3</em>. This metric measures
the Kullback-Leibler divergence between the conditional and marginal label distributions
over generated data. Defined as:</p>

\[IS(\mathcal{G}) = \exp [ \mathbb{E}_{x \sim \mathbb{P}_\mathcal{G}} D_{KL}(p_\mathcal{M}(y|x) \| p_\mathcal{M}(y)) ]\]

<p>where $\mathcal{G}$ stands for generator model in interest, pre-trained inception model $\mathcal{M}$.
Though IS is widely adopted through many literatures, shortcomings of IS emerged.
First, the metric depends on the distributions, both based on $\mathcal{M}$, and second,
the distribution of the real data ($\mathbb{P}_{r}$) is not used anywhere.<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup> Hence, IS
is prone to</p>

<ul>
  <li>be exploited or gamed. This means the model can overfit to ‚Äòeasier‚Äô classes, 
not covering the whole labels.</li>
  <li>miss useful ‚Äòreal‚Äô features, as the metric only relies on $\mathcal{M}$.</li>
</ul>

<h3 id="fr√©chet-inception-distance-fid">Fr√©chet Inception Distance (FID)</h3>

<p>FID is suggested to overcome IS‚Äôs shortcomings. This idea is originated
from the signal difference metric. According to DeepLearning.ai‚Äôs explanation,
we can understand the original Fr√©chet distance as <em>minimum leash distance 
between a human and a dog strolling</em>.</p>

<p>FID uses not only pre-trained Inception-v3‚Äôs feature maps, but also bases on the
objective dataset‚Äôs distribution. Defined as:</p>

\[FID(r, \mathcal{G}) = \| \mu_r - \mu_\mathcal{G} \|^2_2 + tr ( \Sigma_r + \Sigma_\mathcal{G} - 2 \sqrt{\Sigma_r \Sigma_\mathcal{G}} )\]

<p>where $\mu_\cdot$ is the mean and $\Sigma_\cdot$ is the covariance matrix.
The lower the FID, the better model $\mathcal{G}$ is.
Hence, FID is likely to measure the FD between two multivariate normal distributions.
FID still has limitations such as:</p>

<ul>
  <li>cannot capture all the real features as it puts its feet on Inception.</li>
  <li>needs a large sample size to reduce noise during the calculation.</li>
  <li>only limited statistics used. Normal distribution assumption could lose information.</li>
</ul>

<p>Based on my experience, <a href="https://github.com/mseitzer/pytorch-fid">pytorch-FID</a> took
~2 min for 3K and 5K image pools one Nvidia Titan RTX.</p>

<h3 id="maximum-mean-discrepancy-mmd">Maximum Mean Discrepancy (MMD)</h3>

<p>Above two metric are widely used in practice, but we can also take a look at
a non-Inception-based metric. MMD measures the dissimiliarity between the real
distribution and generated distribution for some fixed kernel function $k$.</p>

\[MMD_k (r, \mathcal{G}) = \mathbb{E}_{x, x' \sim \mathbb{P}_r} [k(x, x')]
- 2\mathbb{E}_{x \sim \mathbb{P}_r,\ y \sim \mathbb{P}_\mathcal{G}} [k(x, y)]
+ \mathbb{E}_{y, y' \sim \mathbb{P}_\mathcal{G}} [k(y, y')]\]

<p>Empirically, MMD works well with the kernels on feature 
space of pre-trained ResNet. The computing complexity is also low, so some studies
suggest to use this metric.<sup id="fnref:2:1" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup></p>

<h3 id="bonus-perceptual-path-length-ppl">Bonus: Perceptual Path Length (PPL)</h3>

<p>For the last metric, we can also take look at the off-topic-but-maybe-useful
measurement. PPL is first introduced in StyleGAN<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup> for measuring ‚Äúhow a generator
manages smoothly interpolate between points in its latent space‚Äù.
The authors used VGG16 embeddings for comparison to concur with human perception.
PPL on the latent space $\mathcal{Z}$ would be:</p>

\[PPL_\mathcal{Z} = \mathbb{E} \left[ \frac{1}{\epsilon^2} d(\mathcal{G}(\text{slerp}(z_1, z_2; t)), \mathcal{G}(\text{slerp}(z_1, z_2; t+\epsilon))) \right]\]

<p>where $d$ is the perceptual distance between the images on VGG16, 
$\text{slerp}$ is the spherical linear interpolation,
and $\epsilon=10^{-4}$ as an arbitrary small number.
This looks sneezy but this means the empirical mean of the perceptual distances
between consequently generated images.</p>

<p>This measure fits perfectly to the objective of StyleGAN - to learn the disentangled
continuously controllable styles with the latent vectors.</p>

<h2 id="wrap-up">Wrap up</h2>

<p>Although FID and IS are widely used in the field, they are still not the gold-standard
for the GAN performance metric. Researchers are seeking alternatives, so we can
wait for the brains of the era find the result :smile:</p>

<h2 id="read-more">Read more</h2>

<ol>
  <li><a href="https://machinelearningmastery.com/how-to-evaluate-generative-adversarial-networks/">How to evaluate generative adversarial networks</a>, J. Brownlee, 2019</li>
  <li><a href="https://www.coursera.org/lecture/build-better-generative-adversarial-networks-gans/evaluation-qTs8q">Evaluation</a>, DeepLearning.ai on Coursera, 2020</li>
</ol>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Borji, Ali. ‚ÄúPros and cons of gan evaluation measures.‚Äù Computer Vision and Image Understanding 179 (2019): 41-65¬†<a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a>¬†<a href="#fnref:1:1" class="reversefootnote" role="doc-backlink">&#8617;<sup>2</sup></a>¬†<a href="#fnref:1:2" class="reversefootnote" role="doc-backlink">&#8617;<sup>3</sup></a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>Xu, Qiantong, et al. ‚ÄúAn empirical study on evaluation metrics of generative adversarial networks.‚Äù arXiv preprint arXiv:1806.07755 (2018).¬†<a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a>¬†<a href="#fnref:2:1" class="reversefootnote" role="doc-backlink">&#8617;<sup>2</sup></a></p>
    </li>
    <li id="fn:3" role="doc-endnote">
      <p>Karras, Tero, Samuli Laine, and Timo Aila. ‚ÄúA style-based generator architecture for generative adversarial networks.‚Äù Proceedings of the IEEE conference on computer vision and pattern recognition. 2019.¬†<a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>
:ET